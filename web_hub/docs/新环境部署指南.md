# 🚀 ZhiboCut 新环境部署指南

## 📋 快速部署 (推荐)

### 1. 环境要求
- **硬件**: NVIDIA GPU (推荐 8GB+ 显存)
- **系统**: Windows 10/11 64位
- **驱动**: NVIDIA 驱动 >= 470.57.02

### 2. 一键部署
```bash
# 1. 下载项目到新电脑
git clone <项目地址>
cd web_hub

# 2. 创建 Python 环境
conda create -n zhibocut python=3.10.16
conda activate zhibocut

# 3. 运行一键部署脚本
python scripts/一键部署脚本.py

# 4. 验证环境
python scripts/环境验证脚本.py

# 5. 启动系统
python start_production.py --port 8000
```

---

## 🔧 手动部署 (详细步骤)

### 1. CUDA 环境安装
```bash
# 下载并安装 CUDA Toolkit 12.4 或 12.8
# https://developer.nvidia.com/cuda-downloads

# 验证安装
nvidia-smi
nvcc --version
```

### 2. Python 环境创建
```bash
# 创建虚拟环境
conda create -n zhibocut python=3.10.16
conda activate zhibocut

# 配置镜像源 (可选，提升速度)
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

### 3. 依赖安装 (按顺序)
```bash
pip install -r requirements/requirements-01-base.txt
pip install -r requirements/requirements-02-platform-gpu.txt
pip install -r requirements/requirements-03-text.txt
pip install -r requirements/requirements-04-ai.txt
pip install -r requirements/requirements-05-model-base.txt
pip install -r requirements/requirements-06-models.txt
pip install -r requirements/requirements-07-app.txt

# 安装缺失的包
pip install selenium ffmpeg-python
```

### 4. 环境验证
```bash
# 验证 PyTorch GPU 支持
python -c "import torch; print('CUDA可用:', torch.cuda.is_available())"
python -c "import torch; print('GPU名称:', torch.cuda.get_device_name(0))"

# 完整环境验证
python scripts/环境验证脚本.py
```

---

## 📊 源环境配置参考

### 硬件配置
- **GPU**: NVIDIA RTX A4000 (16GB 显存)
- **系统**: Windows 10 (版本 10.0.19045.5965)
- **架构**: AMD64

### 软件版本
- **NVIDIA 驱动**: 573.06
- **CUDA**: 12.8 (系统) / 12.4 (PyTorch)
- **Python**: 3.10.16
- **PyTorch**: 2.6.0+cu124
- **cuDNN**: 9.1.0

### 关键依赖版本
```
torch==2.6.0+cu124
torchaudio==2.6.0+cu124
torchvision==0.21.0+cu124
numpy==2.2.6
opencv-python==4.11.0
librosa==0.11.0
flask==3.1.1
celery==5.3.6
redis==5.0.1
```

---

## ⚠️ 常见问题解决

### CUDA 相关问题
```bash
# 问题: CUDA 不可用
# 解决: 检查驱动版本，重新安装 CUDA Toolkit

# 问题: 版本不兼容
# 解决: 确保系统 CUDA >= PyTorch CUDA 版本
```

### 依赖安装问题
```bash
# 问题: 网络超时
# 解决: 配置国内镜像源
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

# 问题: 依赖冲突
# 解决: 严格按照 requirements 文件顺序安装
```

### 显存不足
```bash
# 问题: GPU 显存不足
# 解决: 
# 1. 关闭其他 GPU 占用程序
# 2. 降低批处理大小
# 3. 使用显存更大的 GPU
```

---

## 🛠️ 环境管理工具

### 验证脚本
- **环境验证**: `python scripts/环境验证脚本.py`
- **一键部署**: `python scripts/一键部署脚本.py`
- **启动脚本**: `启动ZhiboCut.bat` (自动生成)

### 监控命令
```bash
# GPU 状态监控
nvidia-smi

# Python 包列表
pip list

# 环境信息
conda info
```

---

## 📞 技术支持

### 部署问题排查
1. 查看详细报告: `docs/zhibocut环境部署报告.md`
2. 运行环境验证: `python scripts/环境验证脚本.py`
3. 检查启动文档: `docs/如何启动系统.md`

### 提供信息
如遇问题，请提供：
- `nvidia-smi` 输出
- `python --version` 输出
- `pip list | grep torch` 输出
- 具体错误信息

---

## ✅ 部署成功标志

### 验证通过指标
- ✅ GPU 检测成功
- ✅ CUDA 可用
- ✅ PyTorch GPU 支持
- ✅ 关键依赖完整
- ✅ 系统启动成功

### 最终测试
```bash
# 启动系统测试
python start_production.py --port 8000

# 浏览器访问
http://localhost:8000
```

**🎉 看到 ZhiboCut 界面即表示部署成功！**
