# 项目开发标准梳理

## 一、背景与目标
- **项目定位**：`web_hub` 作为论坛自动化处理中枢，负责监控、调度和多模态任务适配；`tts/custom_integration` 提供本地语音克隆与合成流程。
- **主要目标**：
  - 保留 `tts/indextts2` 原始开源代码，不做拆分。
  - 将自研 TTS 集成纳入框架化架构，同时预留视频、图片等后续能力。
  - 提供统一任务模型、状态可观测与扩展接口。

## 二、目录结构与职责
- `web_hub/`：集群监控 (`cluster_monitor/`)、轻量工作节点 (`lightweight/`)、模块适配 (`modules/`)、依赖 (`requirements/`)。
- `services/tts_service/`：封装 IndexTTS2 集成，向框架暴露标准任务处理接口。
- `web_hub/modules/tts_adapter/`：调度适配层，消费 `tts`、`voice_clone` 等任务类型。
- `tts/indextts2/`：原始开源工程，仅保留目录占位。
- `tts/custom_integration/`：论坛集成入口与业务逻辑（`integration/` 目录）。
- `shared/`：共享组件预留，计划放置队列、权限、存储等通用模块。
- `docs/`：规范、操作指南、架构说明；本文件记录需求基线。

## 三、功能规划
1. **论坛任务入口**：统一由 `cluster_monitor` 解析帖子 → 入队 → 调度。
2. **TTS 处理链路**：`TTSModuleAdapter` → `TTSTaskService` → `custom_integration` 业务 → 论坛回帖。
3. **多模态扩展**：
   - 视频：以 `web_hub/lightweight` 流水线为基础，封装 `video_adapter`、`video_service`。
   - 图片：预留 `image_adapter`、`image_service` 框架，并复用通用权限/存储模块。
4. **状态与监控**：建立统一任务表或队列视图，提供处理进度、失败重试、告警接口。

## 四、开发步骤建议
1. **任务模型落地**：定义 `task_type`、`payload`、`attachments`、`state` 等字段，完善调度注册机制。
2. **接入 TTS**：将现有论坛集成改造为消费式服务，验证从帖子到回帖的闭环。
3. **抽象共享组件**：在 `shared/` 中实现 Redis/数据库、权限、配额、日志工具，供多模态复用。
4. **扩展视频/图片**：新增对应模块与服务，统一接入调度并完善测试。
5. **监控与运维**：扩展 `cluster_monitor` 前端展示任务队列、状态统计、错误明细。

## 五、开发规范
- **代码风格**：Python 统一 4 空格缩进，模块小写下划线，类名 PascalCase，提交前运行必要的格式化与静态检查。
- **测试策略**：`pytest` 为首选框架，测试文件命名 `test_<module>.py`，覆盖正常/异常路径。
- **提交要求**：提交信息采用动词短语（如 `Add TTS adapter skeleton`），PR 需包含变更说明、测试结果及相关截图/日志。
- **安全配置**：环境变量写入 `.env` 或系统环境，参考 `web_hub/.env.example`；模型权重、数据库备份默认被忽略，禁止上传。
