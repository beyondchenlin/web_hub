# 多论坛监控使用指南

## 📋 概述

多论坛监控系统允许你同时监控多个论坛网站，自动发现新帖并提交处理任务。

## 🎯 功能特性

- ✅ **并行监控**：多线程同时监控多个论坛
- ✅ **独立进程**：各论坛互不影响，故障隔离
- ✅ **统一配置**：所有论坛配置集中在 `config/forum_settings.yaml`
- ✅ **灵活控制**：可以单独启用/禁用某个论坛
- ✅ **状态监控**：实时查看各论坛监控状态
- ✅ **自动重试**：出错时自动重试，不影响其他论坛

## 🚀 快速开始

### 1. 配置论坛

编辑 `config/forum_settings.yaml`：

```yaml
# 全局凭证配置（所有论坛的默认凭证）
credentials:
  username: AI剪辑助手
  password: 594188@lrtcai

# 多论坛配置
forums:
  main:
    name: 懒人同城号AI - TTS论坛
    base_url: https://tts.lrtcai.com
    target_url: https://tts.lrtcai.com/forum-2-1.html
    forum_id: 2
    enabled: true
    check_interval: 10  # 检查间隔（秒）
    auto_reply: true    # 是否自动回复
    test_mode: false    # 测试模式
    test_once: false    # 单次运行
  
  forum2:
    name: 另一个论坛
    base_url: https://example.com
    target_url: https://example.com/forum-1-1.html
    forum_id: 1
    enabled: true
    check_interval: 15
    auto_reply: true
    test_mode: false
    test_once: false
    credentials:  # 为此论坛指定特定凭证
      username: 另一个用户名
      password: 另一个密码
```

### 2. 启动监控

**Windows**：
```bash
启动多论坛监控.bat
```

**Linux/Mac**：
```bash
cd web_hub
python multi_forum_crawler.py
```

### 3. 查看状态

启动后，系统会显示：
- 各论坛的初始化状态
- 监控线程启动情况
- 实时发现的新帖
- 任务提交情况

## 📊 配置说明

### 论坛配置项

| 配置项 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `name` | string | 是 | 论坛名称（用于显示） |
| `base_url` | string | 是 | 论坛基础URL |
| `target_url` | string | 是 | 要监控的板块URL |
| `forum_id` | int | 是 | 板块ID |
| `enabled` | bool | 否 | 是否启用（默认true） |
| `check_interval` | int | 否 | 检查间隔秒数（默认10） |
| `auto_reply` | bool | 否 | 是否自动回复（默认true） |
| `test_mode` | bool | 否 | 测试模式（默认false） |
| `test_once` | bool | 否 | 单次运行（默认false） |
| `credentials` | object | 否 | 特定凭证（可选） |

### 凭证配置

**全局凭证**（所有论坛默认使用）：
```yaml
credentials:
  username: 默认用户名
  password: 默认密码
```

**论坛特定凭证**（覆盖全局凭证）：
```yaml
forums:
  forum1:
    credentials:
      username: 特定用户名
      password: 特定密码
```

## 🎛️ 运行模式

### 生产模式（默认）
```yaml
test_mode: false
test_once: false
```
- 持续监控论坛
- 只处理新帖（跳过已处理）
- 自动保存处理记录

### 测试模式
```yaml
test_mode: true
test_once: false
```
- 持续监控论坛
- 处理所有帖子（包括已处理）
- 不保存处理记录

### 单次测试模式
```yaml
test_mode: true
test_once: true
```
- 只运行一次
- 处理所有帖子
- 不保存处理记录

## 📈 监控状态

### 查看实时状态

系统每分钟自动显示状态：
```
📊 多论坛监控状态
==================================================
运行状态: 🟢 运行中
论坛总数: 2
活跃线程: 2

📍 懒人同城号AI - TTS论坛 (main)
   状态: 🟢 活跃
   模式: 🚀 生产
   网站: https://tts.lrtcai.com
   已处理: 15 个帖子

📍 另一个论坛 (forum2)
   状态: 🟢 活跃
   模式: 🚀 生产
   网站: https://example.com
   已处理: 8 个帖子
```

### 手动查看状态

```bash
cd web_hub
python multi_forum_crawler.py --status
```

## 🛑 停止监控

按 `Ctrl+C` 优雅停止所有监控线程。

## 🔧 故障排查

### 问题1：某个论坛登录失败

**现象**：
```
❌ 论坛 forum2 登录失败
```

**解决**：
1. 检查该论坛的凭证是否正确
2. 检查论坛URL是否可访问
3. 查看日志了解详细错误

### 问题2：监控线程停止

**现象**：
```
📍 某论坛 (forum2)
   状态: 🔴 停止
```

**解决**：
1. 查看控制台错误信息
2. 检查网络连接
3. 重启监控系统

### 问题3：任务提交失败

**现象**：
```
❌ 提交处理任务失败: ...
```

**解决**：
1. 确保 Redis 服务正在运行
2. 检查任务队列是否正常
3. 查看详细错误日志

## 🏗️ 架构说明

### 系统架构

```
多论坛监控系统
├── ForumConfigManager      # 配置管理器
│   └── 从 config/forum_settings.yaml 读取配置
├── MultiForumCrawler       # 多论坛爬虫管理器
│   ├── 论坛1监控线程
│   ├── 论坛2监控线程
│   └── 论坛N监控线程
└── QueueManager            # 任务队列管理器
    └── 提交任务到 Redis 队列
```

### 工作流程

1. **初始化**：读取配置，创建爬虫实例
2. **登录**：各论坛并行登录
3. **监控**：每个论坛独立线程监控
4. **发现**：检测新帖子
5. **提交**：创建任务提交到队列
6. **处理**：工作节点处理任务
7. **回复**：处理完成后自动回复

## 📝 最佳实践

### 1. 合理设置检查间隔

- 高频论坛：5-10秒
- 中频论坛：10-30秒
- 低频论坛：30-60秒

### 2. 使用测试模式验证

新增论坛时，先使用测试模式验证：
```yaml
test_mode: true
test_once: true
```

### 3. 监控系统资源

- 每个论坛一个线程
- 建议不超过10个论坛同时监控
- 注意网络带宽和CPU使用率

### 4. 日志管理

- 定期清理日志文件
- 使用日志轮转
- 保留关键错误日志

## 🔗 相关文档

- [使用文档.md](../使用文档.md) - 完整系统使用文档
- [config/forum_settings.yaml](../config/forum_settings.yaml) - 配置文件
- [web_hub/multi_forum_crawler.py](../web_hub/multi_forum_crawler.py) - 源代码

## 💡 常见问题

**Q: 可以同时监控多少个论坛？**
A: 理论上无限制，但建议不超过10个，以保证系统稳定性。

**Q: 如何临时禁用某个论坛？**
A: 在配置文件中设置 `enabled: false`，然后重启监控系统。

**Q: 监控系统会占用多少资源？**
A: 每个论坛约占用 10-20MB 内存，CPU使用率很低（<5%）。

**Q: 如何添加新论坛？**
A: 在 `config/forum_settings.yaml` 的 `forums` 下添加新配置，重启系统即可。

---

**最后更新**: 2025-11-03
**版本**: v1.0

